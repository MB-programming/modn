/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚ÙˆØ§Ù„Ø¨ - Templates Configuration
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

   Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ù…ÙˆÙ‚Ø¹ ÙˆØ­Ø¬Ù… Ø§Ù„ÙƒÙ„Ø§Ù… Ø¹Ù„Ù‰ Ø§Ù„ØªØµÙ…ÙŠÙ…Ø§Øª:

   ğŸ“ fontScale (Ø­Ø¬Ù… Ø§Ù„Ø®Ø·):
      - Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ù† 0.01 Ø¥Ù„Ù‰ 0.2
      - ÙƒÙ„ Ù…Ø§ Ø²Ø§Ø¯Øª Ø§Ù„Ù‚ÙŠÙ…Ø©ØŒ ÙƒÙ„ Ù…Ø§ Ø§Ù„Ø®Ø· Ø¨Ù‚Ù‰ Ø£ÙƒØ¨Ø±
      - Ù…Ø«Ø§Ù„: 0.12 = Ø®Ø· ÙƒØ¨ÙŠØ±ØŒ 0.05 = Ø®Ø· ØµØºÙŠØ±

   ğŸ“ nameX (Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙƒÙ„Ø§Ù… Ø£ÙÙ‚ÙŠØ§Ù‹ - ÙŠÙ…ÙŠÙ†/Ø´Ù…Ø§Ù„):
      - Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ù† 0 Ø¥Ù„Ù‰ 1
      - 0 = Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠÙ…ÙŠÙ†
      - 0.5 = Ø§Ù„Ù…Ù†ØªØµÙ
      - 1 = Ø£Ù‚ØµÙ‰ Ø§Ù„ÙŠØ³Ø§Ø±

   ğŸ“ nameY (Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙƒÙ„Ø§Ù… Ø±Ø£Ø³ÙŠØ§Ù‹ - ÙÙˆÙ‚/ØªØ­Øª):
      - Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…Ù† 0 Ø¥Ù„Ù‰ 1
      - 0 = Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©
      - 0.5 = Ù…Ù†ØªØµÙ Ø§Ù„ØµÙˆØ±Ø©
      - 1 = Ø£Ø³ÙÙ„ Ø§Ù„ØµÙˆØ±Ø©

   ğŸ¨ fontColor (Ù„ÙˆÙ† Ø§Ù„Ø®Ø·):
      - Ø§Ø³ØªØ®Ø¯Ù… ÙƒÙˆØ¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù…Ø«Ù„: '#FFFFFF' (Ø£Ø¨ÙŠØ¶)ØŒ '#D4AF37' (Ø°Ù‡Ø¨ÙŠ)

   ğŸŒ«ï¸ shadowColor & shadowBlur (Ø¸Ù„ Ø§Ù„Ø®Ø·):
      - shadowColor: Ù„ÙˆÙ† Ø§Ù„Ø¸Ù„ Ù…Ø«Ù„ 'rgba(0, 0, 0, 0.8)' (Ø£Ø³ÙˆØ¯ Ø´ÙØ§Ù)
      - shadowBlur: Ù…Ø¯Ù‰ Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø¸Ù„ (ÙƒÙ„ Ù…Ø§ Ø²Ø§Ø¯ØŒ ÙƒÙ„ Ù…Ø§ Ø§Ù„Ø¸Ù„ Ø¨Ù‚Ù‰ Ø£ÙˆØ³Ø¹)

   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const TEMPLATES = {
    'wida-one': {
        imgId: 'img-wida-one',

        // Ø­Ø¬Ù… Ø§Ù„Ø®Ø·: 0.12 = ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹
        fontScale: 0.12,

        // Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙƒÙ„Ø§Ù… Ø£ÙÙ‚ÙŠØ§Ù‹: 0.5 = ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
        nameX: 0.5,

        // Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙƒÙ„Ø§Ù… Ø±Ø£Ø³ÙŠØ§Ù‹: 0.84 = ØªØ­Øª Ø®Ø§Ù„Øµ (Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø¢Ø®Ø± Ø§Ù„ØµÙˆØ±Ø©)
        nameY: 0.84,

        // Ù„ÙˆÙ† Ø§Ù„Ø®Ø·: Ø£Ø¨ÙŠØ¶
        fontColor: '#FFFFFF',

        // Ù„ÙˆÙ† Ø§Ù„Ø¸Ù„: Ø£Ø³ÙˆØ¯ Ø´ÙØ§Ù
        shadowColor: 'rgba(0, 0, 0, 0.8)',

        // Ù…Ø¯Ù‰ Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø¸Ù„: 20 = Ø¸Ù„ ÙˆØ§Ø¶Ø­
        shadowBlur: 20
    },
    'wida-two': {
        imgId: 'img-wida-two',

        // Ø­Ø¬Ù… Ø§Ù„Ø®Ø·: 0.09 = Ù…ØªÙˆØ³Ø·
        fontScale: 0.09,

        // Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙƒÙ„Ø§Ù… Ø£ÙÙ‚ÙŠØ§Ù‹: 0.5 = ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ
        nameX: 0.5,

        // Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙƒÙ„Ø§Ù… Ø±Ø£Ø³ÙŠØ§Ù‹: 0.71 = ÙÙŠ Ø§Ù„Ù†Øµ Ø§Ù„Ø³ÙÙ„ÙŠ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹
        nameY: 0.71,

        // Ù„ÙˆÙ† Ø§Ù„Ø®Ø·: Ø£Ø¨ÙŠØ¶
        fontColor: '#FFFFFF',

        // Ù„ÙˆÙ† Ø§Ù„Ø¸Ù„: Ø£Ø³ÙˆØ¯ Ø´ÙØ§Ù
        shadowColor: 'rgba(0, 0, 0, 0.8)',

        // Ù…Ø¯Ù‰ Ø§Ù†ØªØ´Ø§Ø± Ø§Ù„Ø¸Ù„: 25 = Ø¸Ù„ Ø£ÙˆØ¶Ø­ Ø´ÙˆÙŠØ©
        shadowBlur: 25
    }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Ø£Ù…Ø«Ù„Ø© Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹:

   âœ… Ù„Ùˆ Ø¹Ø§ÙŠØ² Ø§Ù„ÙƒÙ„Ø§Ù… ÙŠØ±ÙˆØ­ ÙÙˆÙ‚:
      nameY: 0.2  (ÙÙŠ Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø£ÙˆÙ„ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©)

   âœ… Ù„Ùˆ Ø¹Ø§ÙŠØ² Ø§Ù„ÙƒÙ„Ø§Ù… ÙŠØ±ÙˆØ­ ÙŠÙ…ÙŠÙ†:
      nameX: 0.7  (Ø¬Ù‡Ø© Ø§Ù„ÙŠÙ…ÙŠÙ†)

   âœ… Ù„Ùˆ Ø¹Ø§ÙŠØ² Ø§Ù„ÙƒÙ„Ø§Ù… ÙŠØ±ÙˆØ­ Ø´Ù…Ø§Ù„:
      nameX: 0.3  (Ø¬Ù‡Ø© Ø§Ù„ÙŠØ³Ø§Ø±)

   âœ… Ù„Ùˆ Ø¹Ø§ÙŠØ² Ø§Ù„Ø®Ø· Ø£ÙƒØ¨Ø±:
      fontScale: 0.15  (Ø²ÙˆØ¯ Ø§Ù„Ø±Ù‚Ù…)

   âœ… Ù„Ùˆ Ø¹Ø§ÙŠØ² Ø§Ù„Ø®Ø· Ø£ØµØºØ±:
      fontScale: 0.06  (Ù‚Ù„Ù„ Ø§Ù„Ø±Ù‚Ù…)

   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

let selectedTemplate = 'wida-one';

function selectTemplate(template) {
    selectedTemplate = template;

    document.querySelectorAll('.template-option').forEach(opt => {
        opt.classList.remove('selected');
    });

    document.querySelector(`[data-template="${template}"]`).classList.add('selected');
}

function generateCard() {
    const name = document.getElementById('name-input').value.trim();

    if (!name) {
        const input = document.getElementById('name-input');
        input.focus();
        input.style.borderColor = '#ef4444';
        setTimeout(() => input.style.borderColor = '', 2000);
        return;
    }

    const config = TEMPLATES[selectedTemplate];
    const img = document.getElementById(config.imgId);
    const canvas = document.getElementById('result-canvas');
    const ctx = canvas.getContext('2d');

    // Wait for image to load
    const render = () => {
        canvas.width = img.width;
        canvas.height = img.height;

        ctx.drawImage(img, 0, 0);

        const fontSize = Math.floor(canvas.height * config.fontScale);
        ctx.font = `700 ${fontSize}px ShaheenFont, sans-serif`;
        ctx.fillStyle = config.fontColor;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';

        ctx.shadowColor = config.shadowColor;
        ctx.shadowBlur = config.shadowBlur;
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 0;

        ctx.fillText(name, canvas.width * config.nameX, canvas.height * config.nameY);

        // Show step 2
        document.getElementById('step1').classList.remove('active');
        document.getElementById('step2').classList.add('active');
    };

    if (img.complete && img.naturalWidth > 0) {
        render();
    } else {
        img.onload = render;
    }
}

function downloadCard() {
    const canvas = document.getElementById('result-canvas');
    const name = document.getElementById('name-input').value.trim();

    canvas.toBlob(blob => {
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `wida-card-${selectedTemplate}-${name || 'card'}.jpg`;
        link.click();
        URL.revokeObjectURL(link.href);
    }, 'image/jpeg', 0.95);
}

function goBack() {
    document.getElementById('step2').classList.remove('active');
    document.getElementById('step1').classList.add('active');
}

// Enter key to generate
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('name-input').addEventListener('keypress', e => {
        if (e.key === 'Enter') generateCard();
    });
});
